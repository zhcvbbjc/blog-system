<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" th:replace="~{layout :: layout}">
<head>
    <title>首页 - 智能博客系统</title>
</head>
<body>
    <div th:fragment="content">
        <div class="container">
            <!-- 英雄区域 -->
            <div class="hero-section mb-3">
                <div class="card">
                    <h1 class="card-title">欢迎来到智能博客系统</h1>
                    <p class="text-secondary">分享你的想法，发现精彩内容</p>
                </div>
            </div>

            <!-- 主要内容区 -->
            <div class="grid grid-2">
                <!-- 左侧：文章列表 -->
                <div class="main-content">
                    <div class="articles-list" id="articlesList">
                        <!-- 文章卡片 -->
                        <div class="article-card" th:each="article : ${articles}">
                            <h2 class="article-title">
                                <a th:href="@{/article/{id}(id=${article.id})}" 
                                   th:text="${article.title}">文章标题</a>
                            </h2>
                            
                            <div class="article-meta">
                                <span th:text="${article.author.username}">作者</span>
                                <span th:text="${#temporals.format(article.createdAt, 'yyyy-MM-dd HH:mm')}">发布时间</span>
                                <span th:text="${article.viewCount} + ' 阅读'">0 阅读</span>
                            </div>

                            <div class="article-tags" th:if="${article.tags}">
                                <a th:each="tag : ${article.tags}" 
                                   th:href="@{/tag/{tag}(tag=${tag})}"
                                   class="tag" 
                                   th:text="${tag}">标签</a>
                            </div>

                            <p class="article-summary" th:text="${article.summary}">文章摘要...</p>

                            <div class="article-actions">
                                <button class="action-btn like-btn" 
                                        th:attr="data-article-id=${article.id}"
                                        onclick="toggleLike([[${article.id}]])">
                                    <span>👍</span>
                                    <span class="count" th:text="${article.likeCount}">0</span>
                                </button>
                                
                                <button class="action-btn">
                                    <span>💬</span>
                                    <span class="count" th:text="${article.commentCount}">0</span>
                                </button>
                                
                                <button class="action-btn" 
                                        onclick="shareArticle('[[${article.title}]]', window.location.origin + '/article/[[${article.id}]]')">
                                    <span>分享</span>
                                </button>
                            </div>
                        </div>

                        <!-- 加载状态 -->
                        <div class="loading" id="loadingIndicator" style="display: none;">
                            <div class="spinner"></div>
                        </div>
                    </div>

                    <!-- 分页 -->
                    <div class="pagination" th:if="${totalPages > 1}">
                        <a th:href="@{/(page=${currentPage > 0 ? currentPage - 1 : 0})}" 
                           th:if="${currentPage > 0}">上一页</a>
                        
                        <span th:each="i : ${#numbers.sequence(0, totalPages - 1)}"
                              th:class="${i == currentPage} ? 'active' : ''">
                            <a th:href="@{/(page=${i})}" 
                               th:text="${i + 1}">1</a>
                        </span>
                        
                        <a th:href="@{/(page=${currentPage < totalPages - 1 ? currentPage + 1 : totalPages - 1})}" 
                           th:if="${currentPage < totalPages - 1}">下一页</a>
                    </div>
                </div>

                <!-- 右侧：侧边栏 -->
                <div class="sidebar">
                    <div class="sidebar-title">热门标签</div>
                    <div class="tags-cloud" id="tagsCloud">
                        <!-- 标签将通过JavaScript动态加载 -->
                    </div>

                    <div class="sidebar-title mt-3">热门文章</div>
                    <div class="popular-articles" id="popularArticles">
                        <!-- 热门文章将通过JavaScript动态加载 -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // 页面加载时检查点赞状态
        document.addEventListener('DOMContentLoaded', function() {
            const articleIds = Array.from(document.querySelectorAll('.article-card'))
                .map(card => card.querySelector('.like-btn')?.getAttribute('data-article-id'))
                .filter(id => id);
            
            articleIds.forEach(id => {
                if (localStorage.getItem('token')) {
                    checkLikeStatus(id);
                }
            });

            // 加载热门标签和文章
            loadPopularTags();
            loadPopularArticles();
        });

        async function loadPopularTags() {
            // TODO: 实现加载热门标签
        }

        async function loadPopularArticles() {
            // TODO: 实现加载热门文章
        }
    </script>
</body>
</html>

